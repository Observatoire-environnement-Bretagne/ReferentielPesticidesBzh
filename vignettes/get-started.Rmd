---
title: "Get started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Get started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(RefPesticidesBzh)
```

<!-- This vignette is generated by fusen: do not edit by hand -->

```{r}
library(magrittr)
library(dplyr)
```

<!--

# Description du package

Ce package permet d'actualiser et d'exploiter un référentiel des substances actives pesticides à partir des informations obtenues à partir de plusieurs référentiels nationaux, notamment AGRITOX, EPHY. Il inclut les corrections et compléments apportés par le groupe de travail régional animé par l'Observatoire de l'Environnement en Bretagne.
--> 


# Accès aux jeux de données

## Jeu de données des substances actives pesticides

data("substances_actives", package = "RefPesticidesBzh")


## Jeux de données sources

Les tables des jeux de données sources sont inclus dans le package :

- AGRITOX : agritox/*.csv
- EPHY : ephy/*.csv
- OEB : oeb_referentiels_substances_actives/oeb_referentiels_substances_actives.csv
- SIRIS : siris/siris.xls


# Actualiser les jeux de données sources

## Lire les métadonnées du jeu de données à partir de la page data.gouv.fr

```{r examples-1}
metadonnees_dataset('https://www.data.gouv.fr/fr/datasets/base-de-donnees-agritox/')
```

## Téléchargement et décompression du dataset depuis une url

```{r examples-import_dataset}
# Téléchargement du dataset agritox
import_dataset(url='https://www.data.gouv.fr/fr/datasets/r/ce799eee-2cc4-4406-b4b4-318ea35cd5e8', name="agritox", format="zip")

# Téléchargement du dataset ephy
import_dataset(url='https://www.data.gouv.fr/fr/datasets/r/98f7cac6-6b29-4859-8739-51b825196959', name="ephy", format="zip")

# Téléchargement du dataset "Description des substances actives phytosanitaires" de l'OEB
import_dataset(url='http://gide.bretagne-environnement.org/index.php/content/download/25084/384395/file/oeb_referentiels_substances_actives.csv', name="oeb_referentiels_substances_actives", format="csv")

# Les fichiers sont téléchargés dans les sous-dossiers du répertoire de travail
```

```{r examples-load_dataset}

agritox_path <- system.file("agritox/", package = "RefPesticidesBzh")
agritox_raw <- RefPesticidesBzh::load_dataset(path=agritox_path, pattern="*.csv", encoding = "UTF-8")

```

```{r examples-format_agritox}
# Lecture du dataset AGRITOX
agritox_path <- system.file("agritox/", package = "RefPesticidesBzh")
agritox <- RefPesticidesBzh::load_dataset(path=agritox_path, pattern="*.csv", encoding = "Latin-1")

# Ajout de la date de mise à jour à partir de la fiche Data.gouv
agritox$mise_a_jour <- RefPesticidesBzh::metadonnees_dataset('https://www.data.gouv.fr/fr/datasets/base-de-donnees-agritox/')$`Modifiée.le` %>% as.Date("%d %b %Y")

# Mise en forme de la liste des SA avec les attributs retenus pour cette source
agritox_sa <- agritox %>% format_agritox(source_name = "AGRITOX", modified_date = agritox$mise_a_jour)

```

